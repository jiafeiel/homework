# 扩展表达式
    egrep=grep -E
和基本正则的区别是不使用\功能一样，除了位置锚定的\>,\<\b。

# vim：文本编辑器
vim +#打开文件后，让光标处在第#行的行首，+默认行尾
+/PATTERN 打开文件后，直接让光标处于第一个被PATTERN匹配到的行的行首
–b file 二进制方式打开文件
–d file1 file2… 比较多个文件
-m file 只读打开文件
## 三种模式
如果该文件存在，打开并显示内容。不存在则存盘时创建它
命令(Normal)模式：默认模式，移动光标，剪切/粘贴文本
插入(Insert)或编辑模式：修改文本
扩展命令(ex模式)模式：保存，退出等
## 模式切换
命令模式-->插入模式，i、l、a、o
扩展命令模式\插入模式-->命令模式，esc
命令模式-->扩展命令模式，：
## 基本操作
### 扩展命令模式：
:q 退出
:q! 强制退出，丢弃做出的修改
:wq 保存退出
:x 保存退出
### 命令模式
ZZ 保存退出
ZQ 不保存退出
### 字符间跳转：
h: 左 l: 右 j: 下 k: 上
#COMMAND：跳转由#指定的个数的字符
### 当前页跳转：
H：页首 M：页中间行 L:页底
行首行尾跳转：
^: 跳转至行首的第一个非空白字符
0: 跳转至行首
$: 跳转至行尾
### 字符编辑：
x: 删除光标处的字符
#x: 删除光标处起始的#个字符
xp: 交换光标所在处的字符及其后面字符的位置
~:转换大小写
J:删除当前行后的换行符
### 替换命令(r, replace)
r: 替换光标所在处的字符
R:切换成REPLACE模式
### 删除命令：
d: 删除命令，可结合光标跳转字符，实现范围删除
### 复制命令(y, yank)：
y: 复制，行为相似于d命令
### 粘贴命令
p,粘贴到当前光标的后面
P，粘贴到当前光标的前面
### 地址定界（扩展命令模式下）
:start_pos,end_pos
# 具体第#行，例如2表示第2行
#,# 从左侧#表示起始行，到右侧#表示结尾行
#,+# 从左侧#表示的起始行，加上右侧#表示的行数
：2,+3 表示2到5行
. 当前行
$ 最后一行
.,$-1 当前行到倒数第二行
% 全文, 相当于1,$
/pat1/,/pat2/
从第一次被pat1模式匹配到的行开始，一直到第一次被pat2匹配到的行结束
#,/pat/
/pat/,$
### 查找
/PATTERN：从当前光标所在处向文件尾部查找
?PATTERN：从当前光标所在处向文件首部查找
n：与命令同方向
N：与命令反方向
### s: 在扩展模式下完成查找替换操作
格式：s/要查找的内容/替换为的内容/修饰符
要查找的内容：可使用模式
替换为的内容：不能使用模式，但可以使用\1, \2, ...等后向引用符号；还可
以使用“&”引用前面查找时查找到的整个内容
修饰符：
i: 忽略大小写
g: 全局替换；默认情况下，每一行只替换第一次出现
gc:全局替换，每次替换前询问
查找替换中的分隔符/可替换为其它字符，例如
s@/etc@/var@g
s#/boot#/#i
### 撤销
u撤销最近的更改
#u撤销之前多次更改
U 撤消光标落在这行后所有此行的更改
按Ctrl - r重做最后的“撤消”更改
. 重复前一个操作
n.重复前一个操作n次
## vim寄存器
有26个命名寄存器和1个无命名寄存器，常存放不同的剪贴版内容，可以不同会话间共享
寄存器名称a，b,…,z,格式：“寄存器 放在数字和命令之间
如：3"tyy 表示复制3行到t寄存器中
"tp 表示将t寄存器内容粘贴
未指定，将使用无命名寄存器
有10个数字寄存器，用0，1，…，9表示，0存放最近复制内容，1存放最近删除内容。
当新的文本变更和删除时，1转存到2，2转存到3，以此类推。数字寄存器不能在不同会话间共享
## 标记和宏
ma 将当前位置标记为a，26个字母均可做标记， mb 、 mc 等等；
'a 跳转到a标记的位置； 实用的文档内标记方法，文档中跳跃编辑时很有用
qa 录制宏 a，a为宏的名称
q 停止录制宏，
@a 执行宏 a
@@ 重新执行上次执行的宏
## 可视化模式
允许选择的文本块
v 面向字符
V 面向行
ctrl-v  面向块
可视化键可用于与移动键结合使用：
w ) } 箭头等
突出显示的文字可被删除，复制，变更，过滤，搜索，替换等
## 分割窗口
多文件分割
vim -o|-O FILE1 FILE2 ...
-o: 水平分割
-O: 垂直分割
在窗口间切换： Ctrl+w, Arrow
单文件窗口分割：
Ctrl+w,s: split, 水平分割
Ctrl+w,v: vertical, 垂直分割
ctrl+w,q：取消相邻窗口
ctrl+w,o:取消全部窗口
：wqall 退出
## 定制vim
配置文件：永久有效
全局：/etc/vimrc
个人：~/.vimrc
扩展模式：当前vim进程有效
(1) 行号
显示：set number, 简写为set nu
取消显示：set nonumber, 简写为set nonu
(2) 忽略字符的大小写
启用：set ic
不忽略：set noic
(3) 自动缩进
启用：set ai
禁用：set noai
(4) 智能缩进
启用：smartindent 简写 set si
禁用：set nosi
(5) 高亮搜索
启用：set hlsearch
禁用：set nohlsearch
(6) 语法高亮
启用：syntax on
禁用：syntax off
(7) 显示Tab和换行符 ^I 和$显示
启用：set list
禁用：set nolist
(8) 文件格式
启用windows格式：set fileformat=dos
启用unix格式：set fileformat=unix
简写：set ff=dos|unix
(9) 设置文本宽度
set textwidth=65 (vim only)
set wrapmargin=15
(10) 设置光标所在行的标识线
启用：set cursorline，简写cul
禁用：set no cursorline
(11) 复制保留格式
启用：set paste
禁用：set nopaste

# shell脚本：包含一些命令或声明，并符合一定格式的文本文件
格式要求：首行shebang机制（说明文件使用的那种shell）
#!/bin/bash
#!/usr/bin/python
#!/usr/bin/perl
## 脚本调试
检测脚本中的语法错误
bash -n /path/to/some_script
调试执行
bash -x /path/to/some_script
## 变量：命名的内存空间
强类型变量不允许隐式类型转换，弱类型可以。
### 变量命名法则：
1、不能使程序中的保留字：例如if, for
2、只能使用数字、字母及下划线，且不能以数字开头
3、见名知义
4、统一命名规则：驼峰命名法
### 变量种类
根据变量的生效范围等标准划分下面变量类型：
局部变量：生效范围为当前shell进程；对当前shell之外的其它shell进程，包括当前shell的子shell进程均无效
环境（全局）变量：生效范围为当前shell进程及其子进程
变量声明、赋值：
export name=VALUE
declare -x name=VALUE
本地变量：生效范围为当前shell进程中某代码片断，通常指函数
位置变量：$1, $2, ...来表示，用于让脚本在脚本代码中调用通过命令行传
递给它的参数
特殊变量：$?, $0, $*, $@, $#,$$
只读变量：只能声明，但不能修改和删除
声明只读变量：
readonly name
declare -r name
查看只读变量：
readonly –p
### 变量引用
变量引用：${name} $name
""：弱引用，其中的变量引用会被替换为变量值
''：强引用，其中的变量引用不会被替换为变量值，而保持原字符串
显示已定义的所有变量：set
删除变量：unset name
## 退出状态
进程使用退出状态来报告成功或失败
0 代表成功，1－255代表失败
$? 变量保存最近的命令退出状态
###bash自定义退出状态码
exit [n]：自定义退出状态码
注意：脚本中一旦遇到exit命令，脚本会立即终止；终止退出状态取决于exit命
令后面的数字
注意：如果未给脚本指定退出状态码，整个脚本的退出状态码取决于脚本中执行
的最后一条命令的状态码
## 算术运算
bash中的算术运算:help let
+, -, *, /, %取模（取余）, **（乘方）
实现算术运算：
(1) let var=算术表达式
(2) var=$[算术表达式]
(3) var=$((算术表达式))
(4) var=$(expr arg1 arg2 arg3 ...)
(5) declare –i var = 数值
(6) echo ‘算术表达式’ | bc
乘法符号有些场景中需要转义，如*
### bash有内建的随机数生成器：$RANDOM（0-32767）
echo $[$RANDOM%50] ：0-49之间随机数
## 短路运算
短路与
第一个为0，结果必定为0
第一个为1，第二个必须要参与运算
短路或
第一个为1，结果必定为1
第一个为0，第二个必须要参与运算
### 异或：^
异或的两个值,相同为假，不同为真
## 条件测试
判断某需求是否满足，需要由测试机制来实现
专用的测试表达式需要由测试命令辅助完成测试过程
评估布尔声明，以便用在条件性执行中
若真，则返回0
若假，则返回1
测试命令：
test EXPRESSION
[ EXPRESSION ]
[[ EXPRESSION ]]
注意：EXPRESSION前后必须有空白字符
## 数值测试
v VAR
变量VAR是否设置
数值测试：
-gt是否大于
-ge是否大于等于
-eq是否等于
-ne是否不等于
-lt是否小于
-le是否小于等于
## 文件测试：
存在性测试
-a FILE：同-e
-e FILE: 文件存在性测试，存在为真，否则为假
## 文件权限测试
文件权限测试：
-r FILE：是否存在且可读
-w FILE: 是否存在且可写
-x FILE: 是否存在且可执行
## bash的配置文件
按生效范围划分，存在两类：
全局配置：
/etc/profile
/etc/profile.d/*.sh
/etc/bashrc
个人配置：
~/.bash_profile
~/.bashrc
## profile类
按功能划分，存在两类：
profile类和bashrc类
profile类：为交互式登录的shell提供配置
全局：/etc/profile, /etc/profile.d/*.sh
个人：~/.bash_profile
功用：
(1) 用于定义环境变量
(2) 运行命令或脚本
## bashrc类：为非交互式和交互式登录的shell提供配置
全局：/etc/bashrc
个人：~/.bashrc
功用：
(1) 定义命令别名和函数
(2) 定义本地变量
## 修改profile和bashrc文件后需生效
两种方法:
1重新启动shell进程
2 . 或source
例:
. ~/.bashrc

# 文件查找
## locate 非实时查找（数据库查找）
查询系统上预建的文件索引数据库/var/lib/mlocate/mlocate.db
依赖于事先构建的索引，索引的构建是在系统较为空闲时自动进行(周期性任务)，管理员手动更新数据库(updatedb)
选项：i 不区分大小写的搜索
-n N 只列举前N个匹配项目
-r 使用正则表达式
## find：实时查找工具，通过遍历指定路径完成文件查找
find [OPTION]... [查询路径][查找条件][处理动作]，默认输入find是搜索当前目录下的所有文件，包括隐藏文件
### 查询条件
指搜索层级
-maxdepth level 最大搜索目录深度,指定目录为第1级
-mindepth level 最小搜索目录深度
先处理目录内的文件，再处理目录
-depth
### 根据文件名和inode查找：
-name "文件名称"：支持使用glob
*, ?, [], [^]
-iname "文件名称"：不区分字母大小写
-inum n 按inode号查找
-samefile name 相同inode号的文件
-links n 链接数为n的文件
-regex “PATTERN”：以PATTERN匹配整个文件路径，而非文件名称
根据文件类型查找：
-type TYPE:
f: 普通文件
d: 目录文件
l: 符号链接文件
s：套接字文件
b: 块设备文件
c: 字符设备文件
p: 管道文件
### 组合条件：
与：-a
或：-o
非：-not, !
### 根据文件大小来查找：
-size [+|-]#UNIT
常用单位：k, M, G，c（byte）
#UNIT: (#-1, #]
如：6k 表示(5k,6k]
-#UNIT：[0,#-1]
如：-6k 表示[0,5k]
+#UNIT：(#, ∞ )
如：+6k 表示(6k ,∞ )
### 根据权限查找：
-perm [/|-]MODE
MODE: 精确权限匹配
/MODE：任何一类(u,g,o)对象的权限中只要能一位匹配即可，或关系，+从centos7开始淘汰
-MODE：每一类对象都必须同时拥有指定权限，与关系
权限变为二进制，0 表示不关注，1表示必须拥有
### 处理动作
-print：默认的处理动作，显示至屏幕
-ls：类似于对查找到的文件执行“ls -l”命令
-delete：删除查找到的文件
-fls file：查找到的所有文件的长格式信息保存至指定文件中
-ok COMMAND {} \; 对查找到的每个文件执行由 COMMAND 指定的命令，对于每个文件执行命令之前，都会交互式要求用户确认，{}表示查到的文件，\；默认格式
-exec COMMAND {} \; 对查找到的每个文件执行由COMMAND指定的命令
find传递查找到的文件至后面指定的命令时，查找到所有符合条件的文件一次性传递给后面的命令
### 参数替换xargs
由于很多命令不支持管道|来传递参数，而日常工作中有这个必要，所以就有了xargs命令
xargs用于产生某个命令的参数，xargs 可以读入 stdin 的数据，并且以空格符或回车符将 stdin 的数据分隔成为arguments
注意：文件名或者是其他意义的名词内含有空格符的情况
有些命令不能接受过多参数，命令执行可能会失败，xargs可以解决

# 压缩，解压及归档工具
## compress/uncmpress:压缩会删除源文件，生成.Z文件
compress [-dfvcVr] [-b maxbits] [file ...]
-d: 解压缩，相当于uncompress
-c: 结果输出至标准输出,不删除原文件(输出的是压缩的结果内容，可以重定向到文件)
-v: 显示详情
## gzip/gunzip:删除原文件，生成,gz文件，支持标准输入
gzip [OPTION]... FILE ...（压缩多个文件，就会生成多个压缩文件）
-d：解压缩，相当于gunzip（解压缩时。最好是.gz后缀的文件，否则会报错）
-c：结果输出至标准输出，保留原文件不改变
-#：1-9，指定压缩比，值越大压缩比越大
## bzip2
bzip2 [OPTION]... FILE ...
-k：keep, 保留原文件
-d：解压缩
-#：1-9，压缩比，默认为9
## bzcat：不显式解压缩的前提下查看文本文件内容(支持以上几种压缩工具)
可以把显示内容重定向到文件就相当于解压。
## xz(工具比较新)
xz [OPTION]... FILE ...
-k: keep, 保留原文件
-d：解压缩
-#：1-9，压缩比，默认为6
unxz file.xz 解压缩
xzcat: 不显式解压缩的前提下查看文本文件内容
## zip/unzip(打包压缩，前面的压缩工具只能压缩文件，不能压缩文件夹)
打包压缩
zip –r /backup/sysconfig /etc/sysconfig/
解包解压缩
unzip sysconfig.zip
cat /var/log/messages | zip messages -
unzip -p message > message
## tar:打包工具
tar选项可以不加-，生成的打包文件要手动加后缀.tar
(1) 创建归档
tar -cpvf /PATH/FILE.tar FILE...
(2) 追加文件至归档： 注：不支持对压缩文件追加
tar -r -f /PATH/FILE.tar FILE...
(3) 查看归档文件中的文件列表
tar -t -f /PATH/FILE.tar
(4) 展开归档
tar -x -f /PATH/FILE.tar
tar -x -f /PATH/FILE.tar -C /PATH/
(5) 结合压缩工具实现：归档并压缩
-j: bzip2, -z: gzip, -J: xz
-exclude 排除文件
tar zcvf /root/a3.tgz --exclude=/app/host1 --exclude=/app/host2 /app
-T选项指定输入文件,-X选项指定包含要排除的文件列表
tar zcvf mybackup.tgz -T /root/includefilelist -X /root/excludefilelist
splist:：分割一个文件为多个文件
分割大的 tar 文件为多份小文件
split –b Size –d tar-file-name prefix-name
split -b 1M –d mybackup.tgz mybackup-parts
split -b 1M mybackup.tgz mybackup-parts
合并：
cat mybackup-parts* > mybackup.tar.gz

# sed:行编辑器
功能：主要用来自动编辑一个或多个文件,简化对文件的反复操作,编写转换程序等
## 用法：sed [option]... '地址命令' inputfile...
地址和命令是两个内容，可以不写地址，默认对全文操作。命令必须写
## 常用选项：
-n 不输出模式空间内容到屏幕，即不自动打印
-e 多点编辑
-f / PATH/SCRIPT_FILE 从指定文件中读取编辑脚本
-r 支持使用扩展正则表达式
-i.bak 备份文件并原处编辑（备份时要指定备份文件的后缀，要不就是直接编辑文件）
## 地址定界
(1) 不给地址：对全文进行处理
(2) 单地址：
#: 指定的行，$：最后一行
/pattern/：被此处模式所能够匹配到的每一行
(3) 地址范围：
#,#
#,+#
/pat1/,/pat2/（匹配两个模式中间的内容）
#,/pat1/
(4) ~：步进（第一个数表示开始的行，第二个数表示每次加几行）
1~2 奇数行
2~2 偶数行
## 编辑命令：
d 删除模式空间匹配的行，并立即启用下一轮循环
p 打印当前模式空间内容，追加到默认输出之后
a [\]text 在指定行后面追加文本，支持使用\n实现多行追加
i [\]text 在行前面插入文本（要插入空格必须加\否则无效）
c [\]text 替换行为单行或多行文本
w /path/file 保存模式匹配的行至指定文件
r /path/file 读取指定文件的文本至模式空间中匹配到的行后
= 为模式空间中的行打印行号
! 模式空间中匹配行取反处理
## 查找替换
s/// 查找替换,支持使用其它分隔符，s@@@，s###
替换标记：
g 行内全局替换（默认替换每行的第一个匹配）
p 显示替换成功的行
w  /PATH/FILE 将替换成功的行保存至文件中
在分隔符中嵌入变量需要用三个单引号

